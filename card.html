<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shopping Cart</title>
    <!-- Add these links to include Bootstrap CSS and JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link rel="shortcut icon" href="images/favicon.png" type="" />
    <link
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/card.css" />
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>

    <!-- navber section start -->
    <div class="main-navbar shadow-sm sticky-top">
      <div class="top-navbar">
        <div class="container-fluid">
          <div class="row nav-body">
            <div
              class="col-md-2 my-auto d-none d-sm-none d-md-block d-lg-block"
            >
              <h5 class="brand-name">Craftkart</h5>
            </div>

            <div class="col-md-5 my-auto search-container">
              <form role="search" onsubmit="handleSearch(event)">
                <div class="input-group">
                  <input
                    id="search"
                    type="text"
                    placeholder="Search your product"
                    class="form-control"
                  />
                  <button class="btn bg-white btn_size" type="submit">
                    <i class="fa fa-search"></i>
                  </button>
                </div>
              </form>
            </div>

            <div class="col-md-5 my-auto">
              <ul class="nav justify-content-end">
                <li class="nav-item">
                  <a id="cart-count" class="nav-link" href="card.html">
                    <i class="fa fa-shopping-cart"></i> Cart (<span id='cart_count'>0</span>)
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="wishlist.html">
                    <i class="fa fa-heart"></i> Wishlist (<span id='wishlist_count'>0</span>)
                  </a>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    id="navbarDropdown"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <i class="fa fa-user"></i> Username
                  </a>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li>
                      <a class="dropdown-item" href="update_profile.html"
                        ><i class="fa fa-user"></i> Profile</a
                      >
                    </li>

                    <li>
                      <a class="dropdown-item" href="#"
                        ><i class="fa fa-list"></i> My Orders</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="wishlist.html"
                        ><i class="fa fa-heart"></i> My Wishlist</a
                      >
                    </li>
                    <li>
                      <a id="cart-count" class="nav-link" href="card.html">
                        <i class="fa fa-shopping-cart"></i> Cart (<span id='cart_count'>0</span>)
                     </a>
                    </li>
                    <li>
                      <a onclick="handlelogOut(event)" class="dropdown-item"
                        ><i class="fa fa-sign-out"></i> Logout</a
                      >
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
          <a
            class="navbar-brand d-block d-sm-block d-md-none d-lg-none"
            href="#"
          >
            Craftkart
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="contact.html">Contact us</a>
              </li>

              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  All Categories
                </a>
                <ul
                  id="drop_category"
                  class="dropdown-menu"
                  aria-labelledby="navbarDropdown"
                ></ul>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="#arrival">New Arrivals</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#product">Featured Products</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#shop">Why shop</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#product">Fashions</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#seller">Best seller</a>
              </li>
            </ul>
          </div>
          <div>
            <ul class="navbar-nav">
              <li><a class="nav-link" href="register.html">Register</a></li>
              <li><a class="nav-link" href="login.html">Login</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
    <!-- navber section end -->


    <!-- card section start -->
    <section>
      <div class="container">
        <h2 class="px-5 p-2">My shopping cart</h2>
        <div class="cart">
          <div id="cart_containers" class="carts-item col-md-12 col-lg-10 mx-auto">
            <!-- <div class="cart-item">
                  <div class="row">
                     <div class="col-md-7 center-item mx-auto">
                        <img src="/images/ccc1.jpg" alt="...">
                        <h5>Mobile phone</h5>
                     </div>
                     <div class="col-md-5 center-item">
                        <div class="input-group number-spinner">
                           <button id="case-minus" class="btn btn-default"><i class="fas fa-minus"></i></button>
                           <input id="case-number" type="number" min="0" class="form-control text-center" value="1">
                           <button  id="case-plus" class="btn btn-default"><i class="fas fa-plus"></i></button>

                        </div>
                        <h5>$ <span id="case-total">59</span> </h5>
                        <button class="btn btn-danger">Remove</button>
                     </div>
                  </div>
               </div> -->

            <div class="cart-item">
          
            </div>

          </div>
        </div>

        <div class="row g-2">
          <div class="col-6">
            <h5>Subtotal:</h5>
            <h5>Tax:</h5>
            <h5>Total:</h5>
          </div>

          <div class="col-6 status">
            <h5>$<span id="sub-total">1,278</span></h5>
            <h5>$<span id="tax-amount">0</span></h5>
            <h5>$<span id="total-price">1,278</span></h5>
          </div>
        </div>
        <div class="col-md-12 pt-4 pb-4">
          <form action="/create-checkout-session" method="POST">
            <button class="btn btn-primary check-out" type="submit" id="checkout-button">Checkout</button>
          </form>
        </div>
      </div>
    </section>
    <!-- card section end -->

    

    <!-- subscribe section -->
    <section class="subscribe_section">
      <div class="container-fuild">
        <div class="box">
          <div class="row">
            <div class="col-md-6 offset-md-3">
              <div class="subscribe_form">
                <div class="heading_container heading_center">
                  <h3>Subscribe To Get Discount Offers</h3>
                </div>
                <p>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed
                  do eiusmod tempor
                </p>
                <form action="">
                  <input type="email" placeholder="Enter your email" />
                  <button>subscribe</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- end subscribe section -->

    <!-- client section -->
    <section class="client_section layout_padding">
      <div class="container">
        <div class="heading_container heading_center">
          <h2>Customer's Testimonial</h2>
        </div>
        <div
          id="carouselExample3Controls"
          class="carousel slide"
          data-ride="carousel"
        >
          <div class="carousel-inner">
            <div class="carousel-item active">
              <div class="box col-lg-10 mx-auto">
                <div class="img_container">
                  <div class="img-box">
                    <div class="img_box-inner">
                      <img src="images/client.jpg" alt="" />
                    </div>
                  </div>
                </div>
                <div class="detail-box">
                  <h5>Anna Trevor</h5>
                  <h6>Customer</h6>
                  <p>
                    Dignissimos reprehenderit repellendus nobis error quibusdam?
                    Atque animi sint unde quis reprehenderit, et, perspiciatis,
                    debitis totam est deserunt eius officiis ipsum ducimus ad
                    labore modi voluptatibus accusantium sapiente nam! Quaerat.
                  </p>
                </div>
              </div>
            </div>
            <div class="carousel-item">
              <div class="box col-lg-10 mx-auto">
                <div class="img_container">
                  <div class="img-box">
                    <div class="img_box-inner">
                      <img src="images/client.jpg" alt="" />
                    </div>
                  </div>
                </div>
                <div class="detail-box">
                  <h5>Anna Trevor</h5>
                  <h6>Customer</h6>
                  <p>
                    Dignissimos reprehenderit repellendus nobis error quibusdam?
                    Atque animi sint unde quis reprehenderit, et, perspiciatis,
                    debitis totam est deserunt eius officiis ipsum ducimus ad
                    labore modi voluptatibus accusantium sapiente nam! Quaerat.
                  </p>
                </div>
              </div>
            </div>
            <div class="carousel-item">
              <div class="box col-lg-10 mx-auto">
                <div class="img_container">
                  <div class="img-box">
                    <div class="img_box-inner">
                      <img src="images/client.jpg" alt="" />
                    </div>
                  </div>
                </div>
                <div class="detail-box">
                  <h5>Anna Trevor</h5>
                  <h6>Customer</h6>
                  <p>
                    Dignissimos reprehenderit repellendus nobis error quibusdam?
                    Atque animi sint unde quis reprehenderit, et, perspiciatis,
                    debitis totam est deserunt eius officiis ipsum ducimus ad
                    labore modi voluptatibus accusantium sapiente nam! Quaerat.
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="carousel_btn_box">
            <a
              class="carousel-control-prev"
              href="#carouselExample3Controls"
              role="button"
              data-slide="prev"
            >
              <i class="fa fa-long-arrow-left" aria-hidden="true"></i>
              <span class="sr-only">Previous</span>
            </a>
            <a
              class="carousel-control-next"
              href="#carouselExample3Controls"
              role="button"
              data-slide="next"
            >
              <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
      </div>
    </section>
    <!-- end client section -->

    <!-- footer section start -->
    <footer class="footer-section text-light py-4">
      <div class="container">
        <div class="row">
          <div class="col-md-3">
            <img
              src="images/logo_3.png"
              alt="CoolGadgets Logo"
              class="mb-2"
              width="100"
            />
            <div class="information p-0">
              <p>
                <strong>Address:</strong> 28 Alisa tower, Street Name DB Road,
                Gaibandha, Bangaldesh
              </p>
              <p><strong>Phone:</strong> +880 1581528651</p>
              <p><strong>Email:</strong> raselsarkercse@gmail.com</p>
            </div>
          </div>

          <div class="col-md-2">
            <h3>Famms</h3>
            <p>
              Necessary, making<br />
              this the first true in the<br />
              generator on the fact<br />
              Internet. It uses a the<br />
              dictionary of over 200 words, combined with
            </p>
            <div class="footer_social">
              <a href=""><i class="fa-brands fa-facebook"></i></a>
              <a href=""><i class="fa-brands fa-instagram"></i></a>
              <a href=""><i class="fa-brands fa-linkedin"></i></a>
              <a href=""><i class="fa-brands fa-twitter"></i></a>
              <a href=""><i class="fa-brands fa-whatsapp"></i></a>
            </div>
          </div>

          <div class="col-md-2 manu">
            <h3>Manu</h3>
            <ul class="list-unstyled">
              <li>
                <a href="index.html" class="text-decoration-none text-light"
                  >Home</a
                >
              </li>
              <li>
                <a href="about.html" class="text-decoration-none text-light"
                  >About</a
                >
              </li>
              <li>
                <a href="contact.html" class="text-decoration-none text-light"
                  >Contact</a
                >
              </li>
              <li>
                <a href="products.html" class="text-decoration-none text-light"
                  >Products</a
                >
              </li>
              <li>
                <a href="service.html" class="text-decoration-none text-light"
                  >Services</a
                >
              </li>
              <li>
                <a
                  href="testimonial.html"
                  class="text-decoration-none text-light"
                  >Testimonial</a
                >
              </li>
              <li>
                <a href="blog.html" class="text-decoration-none text-light"
                  >Blog</a
                >
              </li>
            </ul>
          </div>
          <div class="col-md-2">
            <h3>Account</h3>
            <ul class="list-unstyled">
              <li>
                <a href="#" class="text-decoration-none text-light">Profile</a>
              </li>
              <li>
                <a href="#" class="text-decoration-none text-light">Register</a>
              </li>
              <li>
                <a href="#" class="text-decoration-none text-light">Login</a>
              </li>
              <li>
                <a href="#" class="text-decoration-none text-light">Checkout</a>
              </li>
              <li>
                <a href="#" class="text-decoration-none text-light"
                  >Blog Post</a
                >
              </li>
              <li>
                <a href="#" class="text-decoration-none text-light"
                  >Return Policy</a
                >
              </li>
              <li>
                <a href="#" class="text-decoration-none text-light">Shopping</a>
              </li>
            </ul>
          </div>

          <!-- newsletter-container -->
          <div class="col-md-3">
            <div class="widget_menu">
              <h3>Newsletter</h3>
              <div class="information_f">
                <p>Subscribe by our newsletter and get update everyday.</p>
              </div>
              <div class="form_sub">
                <form>
                  <fieldset>
                    <div class="field">
                      <input
                        type="email"
                        placeholder="Enter Your Mail"
                        name="email"
                      />
                      <input type="submit" value="Subscribe" />
                    </div>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
        </div>
        <hr class="my-4" />
        <div class="text-center">&copy; Copyright 2024 - Roots Tech</div>
      </div>
    </footer>
    <!-- footer section end -->

    <!-- script file  -->
    <script src="/Js/card.js"></script>
    <script src="/Js/app.js"></script>
    <script src="/Js/wishlist.js"></script>
    <script src="/Js/navber.js"></script>
    <script src="/Js/details.js"></script>
    
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const apiUrl = "https://smart-shoping-whb0.onrender.com/cart/add/";
      
        // Fetch Cart Items
        function fetchCartItems() {
          fetch(apiUrl)
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
            })
            .catch((error) => console.error("Error fetching cart items:", error));
        }
      
        fetchCartItems();
      
        // Update Quantity
        function updateQuantity(product, price, isIncreasing) {
         const productInput = document.getElementById(product + "-number");
         let productNumber = parseInt(productInput.value);
       
         if (isIncreasing) {
           productNumber++;
         } else if (productNumber > 0) {
           productNumber--;
         }
       
         productInput.value = productNumber;
         updateItemTotal(product, productNumber, price);
         calculateTotal();
       }
       
      
        // Update Item Total Price
        function updateItemTotal(product, quantity, price) {
          const itemTotal = document.getElementById(product + "-total");
          itemTotal.innerText = quantity * price;
          calculateTotal(); // Call calculateTotal() after updating the item total
        }
      
        // Calculate Total
        function calculateTotal() {
          let subTotal = 0;
      
          // Loop through each product type
          ["case", "case"].forEach((product) => {
            const productNumber = getInputvalue(product);
            const productPrice = product === "case" ? 1219 : 59; // Update price accordingly
      
            subTotal += productNumber * productPrice;
          });
      
          const tax = subTotal * 0.1; // Assuming tax is 10% of the subtotal
          const totalPrice = subTotal + tax;
      
          // Update on the HTML
          document.getElementById("sub-total").innerText = subTotal;
          document.getElementById("tax-amount").innerText = tax;
          document.getElementById("total-price").innerText = totalPrice;
        }
      
        // Get Input Value
        function getInputvalue(product) {
          const productInput = document.getElementById(product + "-number");
          return parseInt(productInput.value);
        }
      
        // Event Listeners
        document.getElementById("case-plus").addEventListener("click", function () {
          updateQuantity("case", 59, true);
        });
      
        document.getElementById("case-minus").addEventListener("click", function () {
          updateQuantity("case", 59, false);
        });
      
        document.getElementById("case-number").addEventListener("click", function () {
          updateQuantity("case", 1219, true);
        });
      
        document.getElementById("case-minus").addEventListener("click", function () {
          updateQuantity("case", 1219, false);
        });
      
        document.querySelectorAll(".btn-danger").forEach((button) => {
          button.addEventListener("click", function () {
            // Remove item from the cart
            // Recalculate total
          });
        });
      
        document.querySelector(".check-out").addEventListener("click", function () {
          // Implement checkout functionality
        });
      });
      
      
      
      const getProducts = async () => {
         let cart_items = JSON.parse(localStorage.getItem("cart_items"));
         const cartsContainer = document.getElementById("cart_containers");
         cartsContainer.innerHTML = ""; // Clear the container before adding new items
         
         cart_items?.forEach((item, index) => {
           const cartItemHTML = `
             <div class="cart-item">
               <div class="row">
                 <div class="col-md-7 center-item mx-auto">
                   <img src="${item.image}" alt="...">
                   <h5>${item.name}</h5>
                 </div>
                 <div class="col-md-5 center-item">
                   <div class="input-group number-spinner">
                     <button class="btn btn-default decrease-quantity" data-index="${index}"><i class="fas fa-minus"></i></button>
                     <input type="number" min="0" class="form-control text-center quantity-input" value="${item.quantity}"/>
                     <button class="btn btn-default increase-quantity" data-index="${index}"><i class="fas fa-plus"></i></button>
                   </div>
                   <h5>$ <span class="item-total">${parseInt(item.price) * parseInt(item.quantity)}</span> </h5>
                   <button class="btn btn-danger remove-product" data-index="${index}">Remove</button>
                 </div>
               </div>
             </div>
           `;
           cartsContainer.insertAdjacentHTML('beforeend', cartItemHTML);
         });
       
         // Add event listeners to plus and minus buttons
         document.querySelectorAll('.increase-quantity').forEach((button) => {
           button.addEventListener('click', (event) => {
             const index = parseInt(event.target.dataset.index);
             cart_items[index].quantity++;
             updateCart();
           });
         });
       
         document.querySelectorAll('.decrease-quantity').forEach((button) => {
           button.addEventListener('click', (event) => {
             const index = parseInt(event.target.dataset.index);
             if (cart_items[index].quantity > 1) {
               cart_items[index].quantity--;
               updateCart();
             }
           });
         });
       
         // Add event listeners to remove buttons
         document.querySelectorAll('.remove-product').forEach((button, index) => {
           button.addEventListener('click', () => {
             cart_items.splice(index, 1);
             updateCart();
           });
         });
       
         // Function to update cart items and local storage
         function updateCart() {
           localStorage.setItem('cart_items', JSON.stringify(cart_items));
           getProducts(); // Rerender the products
         }
       }
       
       getProducts();
      
      
      // remove functionality
      async function removeProduct(id) {
         let cart_item = JSON.parse(localStorage.getItem("cart_items"))
         let fillercartItem = cart_item.filter(item => item.id !== id);
         localStorage.setItem("cart_items", JSON.stringify(fillercartItem));
      }
      
      
      
      
      
      // add to wishlist function.
      
      const add_to_wishlist = () => {
        document.getElementById("add_to_wishlist_btn").addEventListener("click", async function () {
            const productId = urlParams.get("id"); // Assuming urlParams is defined elsewhere
            let user_id = localStorage.getItem("user_id");
            
            // Fetch product data by ID (replace with your own function)
            const productDataWithOutUser = await fetchProductById(productId);
            
            // Add user_id to product data
            const productData = {
                ...productDataWithOutUser,
                user_id: user_id
            };
      
            // Add quantity to product data
            const quantity = document.getElementById("quantity_value").value;
            productData.quantity = parseInt(quantity);
      
            // Get existing wishlist items from local storage
            let wishlistItems = JSON.parse(localStorage.getItem("wishlist_items")) || [];
      
            // Check if the product already exists in the wishlist
            const existingProductIndex = wishlistItems.findIndex(item => item.id === productData.id);
            if (existingProductIndex !== -1) {
                // If the product already exists, update its quantity
                wishlistItems[existingProductIndex].quantity += productData.quantity;
            } else {
                // If the product is not in the wishlist, add it
                wishlistItems.push(productData);
            }
      
            // Save the updated wishlist items to local storage
            localStorage.setItem("wishlist_items", JSON.stringify(wishlistItems));
      
            // Provide feedback to the user
            alert("Product added to wishlist!");
        });
      }
      
    </script>
  </body>
</html>
